# データのあつかい方

- 本章の説明がわからない人は、森知晴先生のすばらしい動画たちを参考にしてください！
1. [データの読み込み in R](https://youtu.be/FugazO_rL7c)  
1. [データフレームの操作 in R](https://youtu.be/96AZJmGNass)  


## データフレーム

- データ分析をする時は、横方向（行）に観測値を、縦方向（列）に変数を並べることが多い
- 例えば、ある4人の名前、年齢、身長、体重のデータは、次のように並べることが多い

|Name|Age|Height|Weight|Gender|
|:----|:----|:----|:----|:----|
|Tanaka|10|149.5|36|male|
|Suzuki|18|153|48|female|
|Okada|41|171|58|male|
|Watanabe|26|174.5|65|male|


- Rでこのようなデータをあつかう場合、データフレームを使う[^1]
- 上のデータのデータフレームを作るには、以下のようにすれば良い

```{r}
# まず各変数のベクトルを作る
name <- c("Tanaka", "Suzuki", "Okada", "Watanabe")
age <- c(10, 18, 36, 23) #年齢のベクトルの作成
height <- c(149.5, 153.0, 171.0, 174.5)
weight <- c(36, 48, 58, 65)
gender <- c("male", "female", "male", "male") 

# data.frame()の引数に、作成したベクトルを並べる
df <- data.frame(name, age, height, weight, gender)
df
```


## データの読み込み

- 実際にデータ分析する時に、上のようにデータフレームを作ることはまれ
- ほとんどの場合は、外部からデータを読み込む（＝インポートする）
- 以下、よく使われるCSVファイル（.csv）とExcelファイル（.xlsx, .xls）のインポート方法を説明
- 以下の方法を使うと、取り込まれたデータは自動的にデータフレームになる

### ワークディレクトリとインポートの準備

- インポートしたいデータファイルは、ワークディレクトリと呼ばれる場所に置く必要がある[^2]
- ワークディレクトリは、Rを使う時のメインの作業場で、さまざまな操作の起点になる
- 通常Rでは、起動する度に作業ディレクトリを指定する必要がある
- しかし、プロジェクト機能を使っていれば、プロジェクト名のフォルダが作業ディレクトリになる   
（プロジェクトについては２章を参照）




### データの読み込み



1人目が18歳の女性、2人目が21歳の男性…を表すデータフレームが作成できました。 後ほどExcelファイルなどからデータのRにインポートする方法を学びますが、その際は自動的にデータフレームとしてインポートされます。

データ分析の際に、データフレームのうち特定の変数だけを使いたい場合がよくあります。 その際は、データフレーム名$変数名と表記することで、特定の変数を使うことができます。 例えば、先ほど作成したfirst_dataframeから性別の変数のみを見てみましょう。

```{r}
df$gender
```

性別のベクトルを取り出すことができました。 関数と組み合わせると、年齢の平均値を以下のように計算できます。

```{r}
mean(df$age)

```

**練習問題**

- オブジェクトincomeに数値のベクトル10, 100, 1000, 10000, 100000を代入してください。  
- オブジェクトcityに文字列のベクトル"ibaraki", "takatsuki", "ibaraki", "takatsuki", "takatsuki"を代入してください。  
- incomeとcityを合わせたデータフレームincome_dataを作成してください。  
- income_dataを用いて、incomeの中央値を求めてください。

- データの読み込み

データ分析のためには、データをRStudioにインポート（読み込み）させなければなりません。インポートの方法は、持っているデータのファイル形式によって変わります。

## インポートの準備

インポートしたいファイルは、プロジェクトと同じフォルダに入れておきましょう。 プロジェクトはChapter 2で学習しています。

インポートしたいファイルの形式も確認しておきましょう。 代表的な形式として、CSVファイル（.csv）、Excelファイル（.xlsx, .xls）があります。 拡張子が表示されていない場合はこちらを参考に表示させるようにしましょう。

インポートの前に、ファイルの1行目は変数名（英語）にしておきましょう。

## インポート

### CSVファイルの場合（.csv）

CSVファイルの場合は、`read.csv`を用います。ファイルの名前がsotsuron.csvの場合、以下のように実行します。

```{r eval=FALSE}
data_original <- read.csv("sotsuron.csv")
```

これは、csvファイルの内容をdata_originalというオブジェクトに格納しています。 オブジェクト名は自由につけることができますが、わかりやすいものにしましょう。 ここでは、インポートした元データであることを明示するため、data_originalという名前にしています。

**練習問題**  
  
- 以下から「tidy_data.csv」をダウンロード
https://www.dropbox.com/s/wm46esg4dicye8j/tidy_data.csv?dl=0  
- `read.csv`を使って読み込み、dataというオブジェクトに格納


## インポートしたデータの確認

上の練習問題のデータがきちんとインポートされたかどうか、確認しておきましょう。

右上のペーンの“Environment”に新しいオブジェクトができているか確認（上の例ではdata）
クリックして左上のペーンに出てくるか確認
`head(data)`で先頭のデータを確認
`str(data)`で各変数の「型」（後で説明）を確認


[^1]: 行列と同じ2次元のデータ構造だが、データフレームは列(変数)ごとに異なったデータ型を持てる
[^2]: 現在の作業ディレクトリの確認は`getwd()`、変更は`setwd("変更後のディレクトリのパス")`