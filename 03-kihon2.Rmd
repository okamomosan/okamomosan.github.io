# 基本操作②

- 本章の説明がわからない人は、森知晴先生のすばらしい動画たちを参考にしよう！

1. [オブジェクトの使い方 in R](https://youtu.be/CblsIBlzqX0)  
1. [関数の使い方 in R](https://youtu.be/q8MI6P2hoUM)  

- データ型やデータ構造については、逆瀬川浩孝先生のホームページを参照  
[「経営工学雑記帖」内のRのページ](http://www.f.waseda.jp/sakas/R/index.html)


## ベクトルと行列

- Rでは、複数のデータの値をひとまとめにして扱いやすくできる

### ベクトル

- 同じ型のデータを1列に並べたものをベクトルと呼ぶ
- ベクトルは関数`c()`を使って作る
- ベクトルも変数に入れることができる
- 例として、5つの数字（例えば、2,4,2,3,5）を並べたベクトルを変数`v`に代入する

```{r}
v <- c(2, 4, 2, 3, 5) #ベクトルを作り変数に代入
v #変数vの中身を確認
```

- 連番のベクトル（例えば2,3,4,5,6）を作りたい時は、次のようにも書ける

```{r}
v2_6 <- c(2:6) #「n:m」で「nからmまで」の意味
v2_6
```


#### ベクトルと数値の演算： {-} 

- ベクトルにも四則演算の記号（=演算子）を使った演算ができる
- ベクトル内のそれぞれの数字に、四則演算が施される
- 以下の出力結果で確認してみよう

```{r}
v
v+2  #それぞれの数字に２を足す 
2*v  #それぞれの数字に２をかける  

```

##### 練習問題 {-} 
- 上の`v`について、`v-2`、`v/2`、`v^2`の実行結果を確認する

#### ベクトル同士の演算： {-} 

- Rでは、ベクトル同士の演算もできる
- まずは2つのベクトルを用意しよう

```{r}
v1 <- c(1, 2) 
v2 <- c(2, 4) 
```

- これらを`+`を使って「足す」
- すると、１つめの数同士（1と2）と、２つめの数同士(2と4)が足される

```{r}
v1 + v2
```

- `*`を使って「かける」場合も、同じように1つめの数同士、2つめの数同士がかけられる

```{r}
v1 * v2
```

- ベクトル同士の「かけ算」には内積がある
- Rでは、`%*%`で内積を計算できる

```{r}
v1 %*% v2 
```

- ベクトルの長さ（=入っている数値の個数）が違うとおかしな計算になり、警告が出る

```{r}
#以下のv1には3つの要素があるけど、v2には2つしかない
#この場合、v2の1つめの要素を無理やりv1の３つめに足してしまう

v1 <- c(1, 2, 3)  #3つの数を代入
v2 <- c(2, 4) #2つの数を代入
v1 + v2 #長さが違うからうまく計算できず警告が出る
```

- ベクトルの長さを確認するには`length()`を使えば良い

```{r}
length(v1)
```

##### 練習問題 {-} 
- 上の`v1`と`v2`を使い、`-`、`/`、`^`の３つの演算を行う
- いずれも1つめの数値同士、2つめの数値同士で対応した演算がなされることを確かめる

#### 要素の抽出：{-} 

- ベクトルから、任意の要素（`n`番目の数）を抽出する方法を説明する
- `x`という名前のベクトルからn番目の要素を抽出する時は`x[n]`
- 具体例として、先ほどのベクトル`v=c(2,4,2,3,5)`で考える
- 2番目の要素（つまり4）を抜き出したいなら、`v[2]`と書く

- 2〜４番めの要素(つまり4,2,3)を抜き出したいなら、`v[2:4]`と書く

```{r}
v[2:4]
```


### 行列

#### 行列のキホン：{-}

- 同じ型のデータを行と列の2次元に並べたものを行列と呼ぶ
- 例えば、2行3列の行列
$\begin{pmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
\end{pmatrix}$
を作ってMに代入するには、`matrix()`を使い次のように書く

```{r}
#初めの1:6はc(1:6)と同じで「1,2,3,4,5,6」の意味
#この6つの数字を、2つの行(row)と3つの列(col)に分ける
#byrow = Tで、6つの数字を左から右（zの書き順）に埋めるよう指示
#byrow = Tを消すと、上から下に埋める（各自確かめよう）

M <- matrix(1:6, nrow = 2, ncol = 3, byrow = T)
M
```

- 次の関数を使って、ベクトル同士を結合しても行列を作れる

```{r}
v1 <- c(1,2,3) 
v2 <- c(1,1,1) #2つのベクトルv1とv2を作る

rbind(v1, v2) #v1とv2を行(row)方向に繋げる
cbind(v1, v2) #v1とv2を列(column)方向に繋げる

rbind(M, v1) #「行列とベクトル」や「行列同士」も繋げられる
```

#### 要素の抽出：{-}

- 行列`x`から要素を抜き出すには、` x[抜き出したい行、抜き出したい列]`と書く
- 具体例として、先の行列`M`から色々な要素を抜き出してみよう

```{r}
# 2行1列目を抽出し、変数M21に代入
M21 <- M[2,1]

# 2行めを抽出
M[2,]

# 1列めを抽出
M[,1]

# 1,2行めと1,3列めを抽出
M[c(1,2),c(1,3)]

```

#### 行列の演算：{-}
- n行n列の２つの行列同士の計算について、足し算は`+`、引き算は`-`を使えば良い
- 以下の例のように、かけ算は`%*%`を使わなくてはいけないので注意

```{r}

M #先ほど作った2行3列の行列を表示
 
M2 <- matrix(c(1,2,0,1,0,2), nrow = 3, ncol = 2, byrow = T) #新たに3行2列の行列を作る
M2 #今作った2行3列の行列を表示

#２つの行列の積MN
M %*% M2 

#２つの行列の積MN
M2 %*% M　

v <- c(1,2,3) #要素が３つのベクトルを作る

#行列とベクトルのかけ算も%*%を使う
#縦ベクトルと横ベクトルは区別されないので、次のコードで計算できる
v %*% M2 # ただし、M2%*%vのように計算できない場合はエラーが出る（各自確かめよう）


```

---

## 関数②（ベクトルや行列に対する関数）

- 先の`rbind()`や`cbind()`はベクトルや行列も引数にとれる関数だった
- ベクトルや行列に対して使える他の関数をいくつか紹介する

#### ベクトルの頻出関数：{-}

- 以下の関数はどれもよく使うので、しっかり覚えよう

|関数(引数xはベクトル)|意味|
|:----|:----|
|summary(x)|基本統計量の一括表示|
|max(x)|xの要素の最大値|
|min(x)|xの要素の最小値|
|mean(x)|xの平均値|
|median(x)|xの中央値|
|var(x)|xの不偏分散|
|sd(x)|xの不偏標準偏差|
|sum(x)|xの各要素の総和|
|range(x)|xのデータの範囲（最小値と最大値）|
|length(x)|xのデータの個数（ベクトルの次元）|
|sort(x)|xの各要素を小さい順に並び替え|
|sort(x, decreasing = TRUE)|xの各要素を大きい順に並び替え|  

  
- 具体的に理解するため、5人の年齢のデータを作成する

```{r}
age <- c(36, 16, 43, 18, 22) #5人の年齢のベクトルを作成
```

- このベクトル`age`を引数にして、上表のいくつかを実行してみる

```{r}

summary(age) #基本統計量を一括表示

max(age) #一番大きい値を取り出す（5人のうち最年長は43歳）

mean(age) #算術平均（5人の平均年齢は27歳）

var(age) #不偏分散（5人の平均の分散は141）
```

##### 練習問題 {-} 
- 引数を`age`にして、`min()`, `median()`,`sd()`,`sum()`,`range()`,`length()`,`sort()`を実行する
- 各々の結果が何を意味しているのかを解釈する
- 引数を行列`M`にして、上表の各関数の結果を確認する

#### 行列の頻出関数： {-}

- 行列を引数に持つ関数のうち、比較的よく使うものをまとめる
- どのような結果になるかは各自確かめてみよう

|関数(引数xは行列)|意味|
|:----|:----|
|matrix(0, nrow=2, ncol=3) |2 行 3 列のゼロ行列を作成|
|diag(5)|5×5の単位行列作成|
|diag(X) <- 1|行列 X の対角成分を全て 1 にする|
|t(X)|行列 X の転置行列|
|solve(X)|行列 X の逆行列|
|det(X)|行列 X の行列式|
|rowSums(X)|行列 X の行和|
|colSums(X)|行列 X の列和|
|RowMeans(X)|行列 X の行平均|
|colMeand(X)|行列 X の列平均|

##### 練習問題 {-} 
- 上の各関数を先の行列`M`に使い、結果を確かめよう

---

## 関数の自作

**少し難しいのでスキップして3.7に進んでもOK **  
  
- Rには、他にもたくさんの関数が用意されている
- でも、既存関数を駆使しても、長く煩雑なコードでしか処理できないことも多い
- そのようなコーディングを繰り返し実行しなければいけない時は、自作関数を作ると便利
- 自作関数の作り方の基本は以下のとおり

```{r eval = FALSE}
関数名 <- function (引数名) {
  処理内容
}
```

- 例えば、$a/(1-x)$という計算を、様々な`a`と`x`の値で繰り返し実行する必要があるとする
- この計算を実行する関数`inf_geo()`は、次のように自作できる

```{r}
inf_geo <- function (a, x) {
  a/(1-x)
}
```

- 出来上がった関数を使うときは、次のようにする

```{r}
#a=1で、x=0.8を計算したい場合
inf_geo(1, 0.8)
```

---

## データ構造のキホン

- Rにおけるデータの基本単位はベクトル（数値は長さ１のベクトルとみなす）
- Rでは、ベクトルを束ねたさまざまなデータ構造が使われる
- 例えば、行列は同じデータ型のベクトルを積み重ねた２次元のデータ構造
- 他にも、[後の章][データフレーム]で詳しく説明される[データフレーム]などがよく使われる
- より詳しいデータ構造の説明は[逆瀬川先生のホームページ内のコチラ](http://www.f.waseda.jp/sakas/R/Rdata.html)を参照


---

## 演習問題 

- `zemi`という名前のプロジェクトの中に、`exercise_ch4.R`というRスクリプトを作りなさい
- `exercise_ch4.R`に、以下の問題に答るためのコードを書きなさい  <br>

**基本問題：**  <br>

- aさんの身長は149cm, bさんは153cm, cさんは169cm, dさんは174cmとする
- aさんの体重は36kg, bさんは48kg, cさんは61kg, dさんは65kgとする  
<br>
1. 4人の身長を表した数値のみからなるベクトル（単位は不要）を作り、変数hに保存する
1. 変数hの平均と標準偏差を求める  
1. ベクトルのかけ算を使い、４人の身長をインチで表すといくらになるか求める  
 （1cm＝0.39インチで計算し、結果は変数に保存しない）  
1. 4人の体重を表した数値のみからなるベクトル（単位は不要）を作り、変数wに保存する 
1. 変数hと変数wを結合して、１行目が身長、２行目が体重となる2×4行列を作り、変数Mに保存  
1. 行列の要素抽出を使い、変数Mからbさんの体重のデータを抜き出す 
1. 変数wを小さい順に並べ替えることで、身長の低い順に並び替えた変数h2を作る<br><br>
  
**挑戦問題：**  <br>
  
1. xを小数点以下y桁となるように通常の四捨五入をする関数`sisya_gonyu(x,y)`を自作する  
（通常の四捨五入については、前章の演習問題参照）
1. `sisya_gonyu(0.4445,3)`の結果を確認する

```{r eval = FALSE, include = FALSE}
h <- c(149, 153, 169, 174)

mean(h)
sd(h)

0.39 * h

w <- c(36, 48, 61, 65)

M <- rbind(h,w)
M

M[2,2]

h2 <- sort(w)
h2

sisya_gonyu<- function (x, y) {
  floor(x * 10^y + 0.5)/10^y
}

sisya_gonyu(0.4445, 3)
```

